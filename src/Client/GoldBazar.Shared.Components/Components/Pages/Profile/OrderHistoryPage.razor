@page "/profile/order-history"
@rendermode InteractiveServer
@inject OrderService _orderService

@inject IJSRuntime JSRuntime
@using GoldBazar.Client.Web.Components.Pages.Profile.Components;

<PageTitle>GOLD BAZAR - Order History</PageTitle>

<main class="bg-[#f6f6f6] flex flex-col h-dvh overflow-x-hidden overflow-y-auto scroll-smooth">
    <div class="p-[24px] mx-2 border-b-[0.8px] rounded-b-2xl border-[#E0E0E0] bg-white">
        <div class="flex justify-between items-center">
            <h2 class="text-[20px] text-[#1A1A1A]">داواکارییەکانم</h2>
            <button class="cursor-pointer" @onclick="GoBack">
                <ArrowLeft Stroke="currentColor" />
            </button>
        </div>

        <div class="mt-6">
            @foreach (var Order in Orders)
            {
                @* TODO: Here we only show specific orders, since I don't know which of them must be shown here I show submitted orders *@
                if (Order.Status != OrderStatus.Submitted.ToString())
                {
                    continue;
                }

                <OrderHistoryItem Order="@Order" />
            }
        </div>
    </div>

    <OrderHistoryList Orders="@Orders" />
</main>

@code {
    private async Task GoBack()
    {
        await JSRuntime.InvokeVoidAsync("history.back");
    }


    @* TODO: It seems we have 2 OrderDto, so we must specify the full path for it *@
    private List<GoldBazar.Shared.Components.Services.OrderDto> Orders = default!;
    protected override async Task OnInitializedAsync()
    {
        Orders = await _orderService.GetOrders();
    }
}